# Project Documentation

This document provides a detailed, commit-by-commit and file-by-file explanation of the backend development for the Blog Platform.

## Commit History and File Explanations

### Commit 1: `feat(models): add User model with validation`

-   **Description**: This commit introduced the `User` Mongoose model, defining the schema for user data storage.
-   **Affected Files**:
    -   `src/models/User.js`: Defines the `userSchema` with fields for `username`, `email`, `password`, and `role`. It includes validation for uniqueness of username and email, and sets a default role of 'user'.
    -   `server.js`: Initial setup of the Express server and MongoDB connection.
    -   `package.json`: Initialized Node.js project and added dependencies (express, mongoose, bcryptjs, jsonwebtoken).
    -   `package-lock.json`: Generated by npm to lock dependency versions.
    -   `README.md`: Initial empty README file.
    -   `documentation.md`: Initial empty documentation file.

### Commit 2: `feat(auth): implement user registration`

-   **Description**: This commit implemented the user registration functionality, allowing new users to sign up with hashed passwords.
-   **Affected Files**:
    -   `src/controllers/authController.js`: Added the `register` function, which handles user creation, password hashing using `bcryptjs`, and saving the user to the database.
    -   `src/routes/authRoutes.js`: Created this file to define authentication-related routes. It includes a `POST /api/auth/register` route that maps to the `register` function in `authController.js`.
    -   `server.js`: Updated to import and use `authRoutes` for the `/api/auth` endpoint.

### Commit 3: `feat(auth): implement user login`

-   **Description**: This commit added the user login functionality, enabling users to authenticate and receive a JSON Web Token (JWT).
-   **Affected Files**:
    -   `src/controllers/authController.js`: Added the `login` function. This function verifies user credentials, compares passwords using `bcrypt.compare`, and generates a JWT upon successful authentication.
    -   `src/routes/authRoutes.js`: Added a `POST /api/auth/login` route that maps to the `login` function in `authController.js`.

### Commit 4: `feat(middleware): add authentication and authorization middleware`

-   **Description**: This commit introduced middleware for protecting routes and implementing role-based access control.
-   **Affected Files**:
    -   `src/middleware/authMiddleware.js`: Created this file. It contains:
        -   `protect`: Middleware to verify JWT tokens from request headers and attach the authenticated user's information to the request object.
        -   `authorize`: Middleware to restrict access to routes based on user roles (e.g., 'admin', 'user').
    -   `.env`: Created this file to store environment variables, specifically `JWT_SECRET` for signing and verifying JWTs.
    -   `server.js`: Updated to load environment variables using `dotenv` and to ensure the `JWT_SECRET` is accessible.

### Commit 5: `feat(models): add BlogPost model`

-   **Description**: This commit defined the Mongoose model for blog posts.
-   **Affected Files**:
    -   `src/models/BlogPost.js`: Created this file, defining the `blogPostSchema` with fields for `title`, `content`, `author` (referencing the `User` model), `createdAt`, and `updatedAt`.

### Commit 6: `feat(blogposts): implement CRUD operations for blog posts`

-   **Description**: This commit implemented the full set of CRUD operations for blog posts, including authorization checks.
-   **Affected Files**:
    -   `src/controllers/blogPostController.js`: Created this file, containing functions for `createBlogPost`, `getAllBlogPosts`, `getBlogPostById`, `updateBlogPost`, and `deleteBlogPost`. The `updateBlogPost` and `deleteBlogPost` functions include logic to ensure only the author or an admin can modify/delete a post.
    -   `src/routes/blogPostRoutes.js`: Created this file, defining the API routes for blog posts (`/api/blogposts`). It integrates the `protect` middleware for routes requiring authentication and applies authorization checks where necessary.
    -   `server.js`: Updated to import and use `blogPostRoutes` for the `/api/blogposts` endpoint.

### Commit 7: `feat(comments): implement comment system`

-   **Description**: This commit implemented the comment system, allowing users to add, view, and delete comments on blog posts.
-   **Affected Files**:
    -   `src/models/Comment.js`: Created this file, defining the `commentSchema` with fields for `content`, `author` (referencing `User`), `blogPost` (referencing `BlogPost`), and `createdAt`.
    -   `src/controllers/commentController.js`: Created this file, containing functions for `addComment`, `getCommentsByBlogPostId`, and `deleteComment`. The `deleteComment` function includes authorization to ensure only the comment author or an admin can delete a comment.
    -   `src/routes/blogPostRoutes.js`: Updated to include routes for comments nested under blog posts (`/:blogPostId/comments` for adding and getting comments, and `/comments/:id` for deleting a specific comment). These routes also utilize the `protect` middleware.
